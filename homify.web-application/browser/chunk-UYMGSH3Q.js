import"./chunk-BYXBJQAS.js";import{a as q}from"./chunk-366TOATH.js";import{a as E,b as y}from"./chunk-N3TGZAGV.js";import{a as g,b as F,c as P,d as I,e as J}from"./chunk-SYY7HDF4.js";import{c as b,m as A,o as S,x as V}from"./chunk-G254O7HO.js";import{$ as H,Ac as D,D as w,Jb as m,Kb as B,Rb as C,Sa as s,Sb as L,Ta as v,Tb as O,_ as l,da as u,hb as x,ja as f,jb as p,ka as N,mb as M,qb as n,ra as U,rb as i,sa as T,sb as c,vb as j,yb as d,zb as _}from"./chunk-NEYM5HGW.js";var W=(()=>{class e extends P{constructor(t){super(I.homifyApi,"homeowners",t)}updateProfilePicture(t){return this.putById("profile",t).pipe(w(this.handleError))}static{this.\u0275fac=function(o){return new(o||e)(u(b))}}static{this.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Y=(()=>{class e{constructor(t){this._repository=t}updateProfilePicture(t){return this._repository.updateProfilePicture(t)}static{this.\u0275fac=function(o){return new(o||e)(u(W))}}static{this.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var z=(()=>{class e{constructor(t){this.HomeOwnerService=t,this.successMessage="",this.errorMessage="",this.profilePicture=""}handleSubmit(){this.errorMessage="",this.successMessage="";let t={profilePicture:this.profilePicture};this.HomeOwnerService.updateProfilePicture(t).subscribe(o=>this.successMessage="Profile updated successfully",o=>this.errorMessage=o.error.message)}onPPChange(t){this.profilePicture=t.target.value}static{this.\u0275fac=function(o){return new(o||e)(v(Y))}}static{this.\u0275cmp=f({type:e,selectors:[["app-update-profile-form"]],standalone:!0,features:[C],decls:8,vars:4,consts:[[2,"margin-top","30px"],[3,"change","label","value"],[3,"click"],[3,"message"]],template:function(o,r){o&1&&(n(0,"article",0)(1,"p"),m(2,"You can now update your profile picture"),i(),n(3,"app-input",1),d("change",function(Z){return r.onPPChange(Z)}),i(),n(4,"app-button",2),d("click",function(){return r.handleSubmit()}),m(5,"Update"),i(),c(6,"app-success-message",3)(7,"app-error-message",3),i()),o&2&&(s(3),p("label","Picture URL")("value",r.profilePicture),s(3),p("message",r.successMessage),s(),p("message",r.errorMessage))},dependencies:[F,g,E,y]})}}return e})();var G=(()=>{class e extends P{constructor(t){super(I.homifyApi,"roles",t)}addRoleToExistingUser(){return this.putById("").pipe(w(this.handleError))}static{this.\u0275fac=function(o){return new(o||e)(u(b))}}static{this.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var K=(()=>{class e{constructor(t){this._repository=t}addRoleToExistingUser(){return this._repository.addRoleToExistingUser()}static{this.\u0275fac=function(o){return new(o||e)(u(G))}}static{this.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function ie(e,R){e&1&&c(0,"app-update-profile-form")}var Q=(()=>{class e{constructor(t){this.RoleService=t,this.errorMessage="",this.successMessage="",this.showForm=!1}ngOnInit(){let t=JSON.parse(localStorage.getItem("roles")??"[]")||[];console.log(t),this.showForm=t.some(o=>o=="HOMEOWNER")}onClick(){this.errorMessage="",this.successMessage="",this.RoleService.addRoleToExistingUser().subscribe(t=>{this.successMessage="New role added successfully",localStorage.setItem("roles",JSON.stringify(t.roles));let o=JSON.parse(localStorage.getItem("roles")??"[]")||[];this.showForm=o.some(r=>r=="HOMEOWNER")},t=>this.errorMessage=t.error.message)}static{this.\u0275fac=function(o){return new(o||e)(v(K))}}static{this.\u0275cmp=f({type:e,selectors:[["app-homeowner-button"]],standalone:!0,features:[C],decls:5,vars:3,consts:[[3,"click"],[3,"message"]],template:function(o,r){o&1&&(n(0,"app-button",0),d("click",function(){return r.onClick()}),m(1,"Add new role "),i(),c(2,"app-success-message",1)(3,"app-error-message",1),x(4,ie,1,0,"app-update-profile-form")),o&2&&(s(2),p("message",r.successMessage),s(),p("message",r.errorMessage),s(),M(4,r.showForm?4:-1))},dependencies:[g,E,y,z]})}}return e})();var ne=()=>({required:"Email is required"}),se=e=>({email:e}),ae=()=>({required:"Password"}),me=e=>({password:e});function pe(e,R){if(e&1){let t=j();n(0,"div",0)(1,"h1"),m(2," Welcome, "),n(3,"strong"),m(4),i(),m(5,"! "),i(),n(6,"div",1)(7,"p",2),m(8," You can try Home Owner's functionalities by adding a new role to your account "),i(),c(9,"app-homeowner-button"),i(),n(10,"app-button",3),d("click",function(){U(t);let r=_();return T(r.onLogout())}),m(11,"Logout"),i()()}if(e&2){let t=_();s(4),B(t.currentUserName)}}function ce(e,R){if(e&1){let t=j();n(0,"div",4)(1,"h2"),m(2,"Login"),i(),n(3,"form",5),d("submit",function(r){U(t);let a=_();return T(a.onSubmit(r))}),n(4,"div"),c(5,"app-form-input",6),i(),n(6,"div"),c(7,"app-form-input",7),i(),n(8,"app-button",8),m(9,"Login"),i(),c(10,"app-error-message",9),i()()}if(e&2){let t=_();s(5),p("form",t.form)("formField",O(7,se,L(6,ne))),s(2),p("form",t.form)("formField",O(10,me,L(9,ae))),s(),p("type","submit"),s(2),p("message",t.errorMessage)}}var k=(()=>{class e{constructor(t,o){this.fb=t,this.sessionService=o,this.currentUserToken=null,this.currentUserName="",this.errorMessage="",this.form=this.fb.group({email:["",[S.required,S.email]],password:["",[S.required]]})}ngOnInit(){let{token:t,name:o}=this.sessionService.getCurrentUser();this.currentUserToken=t??null,this.currentUserName=o}onSubmit(t){if(t.preventDefault(),this.errorMessage="",!this.form.valid){this.errorMessage="Form is not valid";return}let{email:o,password:r}=this.form.value;this.sessionService.login(o,r).subscribe(a=>{this.sessionService.setCurrentUser(a.token,a.roles,a.name,a.userId),this.currentUserToken=a.token,this.currentUserName=a.name,this.errorMessage=""},a=>{this.errorMessage=a.error.message})}onLogout(){this.currentUserToken=null,this.currentUserName="",this.errorMessage="",this.sessionService.removeCurrentUserToken()}static{this.\u0275fac=function(o){return new(o||e)(v(V),v(J))}}static{this.\u0275cmp=f({type:e,selectors:[["app-login-form"]],standalone:!0,features:[C],decls:2,vars:1,consts:[[1,"div"],[1,"homeowner-info"],[1,"homeowner-message"],[3,"click"],[1,"login-container"],["form","form",1,"'form'",3,"submit"],["name","email","type","mail","label","Email","placeholder","Email",3,"form","formField"],["name","password","type","password","label","Password","placeholder","Password",3,"form","formField"],[3,"type"],[3,"message"]],template:function(o,r){o&1&&x(0,pe,12,1,"div",0)(1,ce,11,12),o&2&&M(0,r.currentUserToken?0:1)},dependencies:[q,g,Q,y],styles:[".div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.homeowner-info[_ngcontent-%COMP%]{background-color:#f0f4f8;padding:20px;border-radius:10px;box-shadow:0 4px 8px #0000001a;margin:20px 0;text-align:center;border:1px solid #e0e0e0;display:flex;flex-direction:column;align-items:center}.homeowner-message[_ngcontent-%COMP%]{color:#333;font-size:1.1rem;margin-bottom:15px;line-height:1.5}"]})}}return e})();var X=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275cmp=f({type:e,selectors:[["app-login"]],decls:1,vars:0,template:function(o,r){o&1&&c(0,"app-login-form")},dependencies:[k]})}}return e})();var ue=[{path:"",component:X,canActivate:[]}],We=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275mod=N({type:e})}static{this.\u0275inj=H({imports:[g,F,k,D,A.forChild(ue)]})}}return e})();export{We as LoginModule};
